block variables
doctype html
html
  head
    meta(charset="utf-8")
    link(rel="shortcut icon", href="/favicon.ico")
    meta(name="viewport", content="width=device-width, initial-scale=1, shrink-to-fit=no")
    meta(name="theme-color", content="#000000")
    title #{ feed.title } | News Reader
    link(rel="stylesheet" href="/styles.css")
    if uri
      link(rel="stylesheet" href=`/${uri}.css`)
    if favicon
      link(rel="icon" href=favicon type="image/x-icon")
    link(rel="preconnect" href="https://fonts.googleapis.com")
    link(rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
    link(href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet")

    if images && images.length > 0
      each image in images
        if image
          link(rel="preload", href=image, as="image")

  body
    div#root
        .header
            div.main#header
                div.logo
                    a.site-title(href=`/`) &#x2302;&nbsp;
                    a(href=`/${uri}`).site-title= title
                button.sidebar-toggle(onclick="toggleSidebar()") &#x2630;
                ul.nav#sidebar
                    for navItem in nav
                        li(class=(page === navItem ? 'active' : ''))
                            a(href=`/${uri}/${navItem}`)= rssFeeds[navItem].name
        .container
            block layout-content
        .catalogue
            ul
                for feed in Object.keys(rssFeeds)
                    li
                        a.catalogue-item(href=`/${uri}/${feed}`)= rssFeeds[feed].name

        .footer
            div
                if feed.copyright
                    span.copyright= feed.copyright
                else
                    span.copyright= "Â© 2023 News Reader. All rights reserved."
                span= "Powered by News Reader using RSS feeds. Last updated: " + date
        div#overlay

        script(type="text/javascript")
            | function toggleSidebar() {
            |   var sidebar = document.getElementById('sidebar');
            |   var overlay = document.getElementById('overlay');
            |   if (sidebar.style.display === 'flex') {
            |     sidebar.style.display = 'none';
            |     overlay.style.display = 'none';
            |   } else {
            |     sidebar.style.display = 'flex';
            |     overlay.style.display = 'block';
            |   }
            | }

        script.
            function getBrightnessFromElement(el) {
                const color = window.getComputedStyle(el).backgroundColor;
                const match = color.match(/\d+/g);
                if (!match) return 255;
                const [r, g, b, a] = match.map(Number);
                if (!r && !g && !b && !a && !!el.parentElement && (el.tagName !== "IMG" || el.classList.contains("banner-image"))) {
                  return getBrightnessFromElement(el.parentElement);
                }
                return 0.299 * r + 0.587 * g + 0.114 * b;
            }

            function updateNavColor() {
                const nav = document.getElementById("header");
                if (!nav) return;

                // Sample a point just below the nav
                const el = document.elementFromPoint(nav.offsetLeft + 10, nav.offsetHeight + 10);
                if (!el) return;

                const brightness = getBrightnessFromElement(el);
                if (brightness < 128) {
                    nav.classList.add("light");
                    nav.classList.remove("dark");
                } else {
                    nav.classList.add("dark");
                    nav.classList.remove("light");
                }
            }

            window.addEventListener("scroll", updateNavColor);
            window.addEventListener("resize", updateNavColor);
            window.addEventListener("load", updateNavColor);
